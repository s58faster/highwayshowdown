

local genv = getgenv()
local function safe_cloneref(obj)
    return (cloneref and cloneref(obj)) or obj
end

genv.getrawmetatable = getrawmetatable or function(t) return getmetatable(t) end
genv.setreadonly = setreadonly or function(t, readonly) end
genv.newcclosure = newcclosure or function(f) return f end
genv.getnamecallmethod = getnamecallmethod or function() return "" end
genv.getgc = getgc or function() return {} end
genv.getconstants = getconstants or function() return {} end
genv.hookfunction = hookfunction or function(f, r) return f end

local ReplicatedStorage = safe_cloneref(game:GetService("ReplicatedStorage"))
local MarketplaceService = safe_cloneref(game:GetService("MarketplaceService"))
local Players = safe_cloneref(game:GetService("Players"))
local RunService = safe_cloneref(game:GetService("RunService"))
local LocalPlayer = Players.LocalPlayer

local AddXPEvent = ReplicatedStorage:WaitForChild("AddXPEvent")
local UpdateHighscoreEvent = ReplicatedStorage:WaitForChild("UpdateHighscoreEvent")
local BuyCarEvent = ReplicatedStorage:WaitForChild("BuyCarEvent")
local SellCarEvent = ReplicatedStorage:WaitForChild("SellCarEvent")
local BuyDensityStageEvent = ReplicatedStorage:WaitForChild("BuyDensityStageEvent")
local UpdateDensityEvent = ReplicatedStorage:WaitForChild("UpdateDensityEvent")

local NamecallInstanceDetector = nil
for _, Table in pairs(getgc(true)) do
    if type(Table) == "table" and rawget(Table, "namecallInstance") then
        for _, Inner in pairs(Table) do
            if type(Inner) == "table" then
                for i, Val in pairs(Inner) do
                    if Val == "kick" and type(Inner[i + 1]) == "function" then
                        NamecallInstanceDetector = Inner[i + 1]
                    end
                end
            end
        end
    end
end

if NamecallInstanceDetector then
    hookfunction(NamecallInstanceDetector, function() return false end)
end

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
    Name = "G Hub - Secured",
    LoadingTitle = "Loading G-HUB...",
    LoadingSubtitle = "Created by lambsideways",
    ConfigurationSaving = { Enabled = false }
})

local MainTab = Window:CreateTab("Main", 4483362458)
genv.targetXP = 0
genv.targetHS = 0
genv.isBoostingXP = false
genv.isBoostingHS = false
local moneyAmount = 100000

MainTab:CreateSection("Currency & Stats")

MainTab:CreateInput({
    Name = "Money Amount",
    PlaceholderText = "Amount to sell car for...",
    Callback = function(text) moneyAmount = tonumber(text) or 100000 end
})

MainTab:CreateButton({
    Name = "Give Money (Instant)",
    Callback = function()
        BuyCarEvent:FireServer("BWM e36 M3 - Stock", 0)
        task.wait(0.1)
        SellCarEvent:FireServer("BWM e36 M3 - Stock", moneyAmount)
        Rayfield:Notify({Title = "Money", Content = "Success!", Duration = 2})
    end
})

MainTab:CreateSection("XP Booster")
MainTab:CreateInput({
    Name = "Target XP Goal",
    PlaceholderText = "Final XP Total...",
    Callback = function(text) genv.targetXP = tonumber(text) or 0 end
})

MainTab:CreateButton({
    Name = "Start XP Boost",
    Callback = function()
        if genv.isBoostingXP then return end
        genv.isBoostingXP = true
        task.spawn(function()
            local xpObj = LocalPlayer:WaitForChild("leaderstats"):FindFirstChild("XP") or LocalPlayer.leaderstats:FindFirstChild("LevelXP")
            while genv.isBoostingXP and xpObj do
                if xpObj.Value < genv.targetXP then
                    AddXPEvent:FireServer(2500)
                    task.wait(0.03)
                else break end
            end
            genv.isBoostingXP = false
            Rayfield:Notify({Title = "Success", Content = "XP Goal Reached!", Duration = 3})
        end)
    end
})

MainTab:CreateSection("Highscore Booster")
MainTab:CreateInput({
    Name = "Target Highscore Goal",
    PlaceholderText = "Final Score...",
    Callback = function(text) genv.targetHS = tonumber(text) or 0 end
})

MainTab:CreateButton({
    Name = "Start Highscore Boost",
    Callback = function()
        if genv.isBoostingHS then return end
        genv.isBoostingHS = true
        task.spawn(function()
            local scoreObj = LocalPlayer:WaitForChild("leaderstats"):FindFirstChild("Highscore") or LocalPlayer.leaderstats:FindFirstChild("Score")
            while genv.isBoostingHS and scoreObj do
                if scoreObj.Value < genv.targetHS then
                    local nextVal = scoreObj.Value + 5000
                    if nextVal > genv.targetHS then nextVal = genv.targetHS end
                    UpdateHighscoreEvent:FireServer(nextVal)
                    task.wait(0.03)
                else break end
            end
            genv.isBoostingHS = false
            Rayfield:Notify({Title = "Success", Content = "Highscore Goal Reached!", Duration = 3})
        end)
    end
})

MainTab:CreateButton({
    Name = "ðŸš¨ STOP ALL BOOSTING",
    Callback = function()
        genv.isBoostingXP = false
        genv.isBoostingHS = false
    end
})

-- 5. Vehicle Tab
local VehicleTab = Window:CreateTab("Vehicles", 4483362458)
local mt = genv.getrawmetatable(game)
local oldNamecall = mt.__namecall

VehicleTab:CreateButton({
    Name = "Auto-Buy All Vehicles (Gamepass Bypass)",
    Callback = function()
        genv.setreadonly(mt, false)
        mt.__namecall = genv.newcclosure(function(self, ...)
            local method = genv.getnamecallmethod()
            if self == MarketplaceService and method == "UserOwnsGamePassAsync" then return true end
            return oldNamecall(self, ...)
        end)
        genv.setreadonly(mt, true)

        task.spawn(function()
            local dealership = LocalPlayer.PlayerGui:WaitForChild("VehicleSpawner"):WaitForChild("Dealership")
            local buyFrame = dealership:WaitForChild("BuyFrame")
            for _, frame in ipairs(buyFrame:GetChildren()) do
                if frame:IsA("Frame") then
                    local price = tonumber(frame:GetAttribute("Price")) or 0
                    BuyCarEvent:FireServer(frame.Name, price)
                    task.wait(0.1)
                end
            end
            Rayfield:Notify({Title = "Garage", Content = "Unlock Complete", Duration = 3})
        end)
    end
})

-- 6. Engine Tab
local EngineTab = Window:CreateTab("Engine", 4483362458)
EngineTab:CreateButton({
    Name = "Unlock Stage 5",
    Callback = function()
        BuyDensityStageEvent:FireServer("Stage 5")
        Rayfield:Notify({Title = "Engine", Content = "Stage 5 Unlocked!", Duration = 3})
    end
})
-- 7. Auto Farm Tab (Restored)
local AutoFarmTab = Window:CreateTab("Auto Farm", 4483362458)
genv.autoFarmEnabled = false
genv.farmInterval = 10

AutoFarmTab:CreateSection("Auto XP & Money Farm")

AutoFarmTab:CreateToggle({
    Name = "Enable Auto Farm",
    CurrentValue = false,
    Callback = function(val)
        genv.autoFarmEnabled = val
        if val then
            task.spawn(function()
                while genv.autoFarmEnabled do
                    AddXPEvent:FireServer(500)
                    BuyCarEvent:FireServer("BWM e36 M3 - Stock", 0)
                    task.wait(0.1)
                    SellCarEvent:FireServer("BWM e36 M3 - Stock", 50000)
                    task.wait(genv.farmInterval)
                end
            end)
        end
    end
})

AutoFarmTab:CreateSlider({
    Name = "Farm Interval (seconds)",
    Range = {1, 60},
    Increment = 1,
    CurrentValue = 10,
    Callback = function(val) genv.farmInterval = val end
})

-- 8. Near Miss (Added to Main Tab)
MainTab:CreateSection("Near Miss Auto-Farm")
local nearMissAmount = 100
genv.nearMissAuto = false

MainTab:CreateSlider({
    Name = "Near Miss Amount",
    Range = {10, 1000},
    Increment = 10,
    CurrentValue = 100,
    Callback = function(val) nearMissAmount = val end
})

MainTab:CreateToggle({
    Name = "Auto Near Miss Farm",
    CurrentValue = false,
    Callback = function(val)
        genv.nearMissAuto = val
        if val then
            task.spawn(function()
                while genv.nearMissAuto do
                    local GiveMoneyEvent = ReplicatedStorage:FindFirstChild("GiveMoneyEvent")
                    if GiveMoneyEvent then GiveMoneyEvent:FireServer(nearMissAmount, "Near miss!") end
                    AddXPEvent:FireServer(nearMissAmount)
                    task.wait(5)
                end
            end)
        end
    end
})

print("[âœ…] G-HUB LOADED")
Rayfield:Notify({
    Title = "Script Ready!",
    Content = "All features loaded successfully!",
    Duration = 6,
    Image = 4483362458
})
